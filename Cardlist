using System;
using System.Collections.Generic;
using System.Linq;

public static class CartasEHabilidades
{
    // Lista de cartas pré-definidas
    public static List<Carta> CriarDeckPrincipal()
    {
        return new List<Carta>
        {
            new Carta(
                nome: "Metall",
                tipo: "Lacaio",
                elemento: "Neutro",
                energia: 0,
                poder: 0,
                resistencia: 600,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Produção em Massa",
                        Tipo = "Passiva",
                        Descricao = "Você pode incluir até 4 cópias desta carta no seu deck principal.",
                        Ativar = (jogador, adversario) =>
                        {
                            Console.WriteLine("Produção em Massa: Você pode incluir até 4 cópias desta carta no seu deck principal.");
                        }
                    }
                }
            ),
            new Carta(
                nome: "Sniper Joe",
                tipo: "Lacaio",
                elemento: "Neutro",
                energia: 0,
                poder: 600,
                resistencia: 1200,
                habilidades: null
            ),
            new Carta(
                nome: "Ataque Poderoso",
                tipo: "Ação",
                elemento: "Neutro",
                energia: 3,
                poder: 0,
                resistencia: 0,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Ataque Poderoso",
                        Tipo = "Ativa",
                        Descricao = "Causa 1000 de dano ao herói adversário.",
                        Ativar = (jogador, adversario) =>
                        {
                            if (adversario.HeroiAtivo != null)
                            {
                                adversario.HeroiAtivo.Resistencia -= 1000;
                                Console.WriteLine($"{adversario.HeroiAtivo.Nome} sofreu 1000 de dano!");
                            }
                        }
                    }
                }
            ),
            new Carta(
                nome: "Escudo de Energia",
                tipo: "Equipamento",
                elemento: "Neutro",
                energia: 2,
                poder: 0,
                resistencia: 0,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Escudo de Energia",
                        Tipo = "Ativa",
                        Descricao = "Aumenta a resistência do herói ativo em 500.",
                        Ativar = (jogador, adversario) =>
                        {
                            if (jogador.HeroiAtivo != null)
                            {
                                jogador.HeroiAtivo.Resistencia += 500;
                                Console.WriteLine($"{jogador.HeroiAtivo.Nome} ganhou 500 de resistência!");
                            }
                        }
                    }
                }
            ),
            new Carta(
                nome: "Elebee",
                tipo: "Lacaio",
                elemento: "Raio",
                energia: 0,
                poder: 300,
                resistencia: 100,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Invisível",
                        Tipo = "Passiva",
                        Descricao = "Não pode ser alvo de ataques nem habilidades do jogador adversário.",
                        Ativar = (jogador, adversario) =>
                        {
                            // A habilidade é passiva, então não precisa de lógica de ativação.
                            // A restrição de não ser alvo é implementada na lógica do jogo.
                        }
                    }
                }
            ),
            new Carta(
                nome: "Protecto",
                tipo: "Lacaio",
                elemento: "Neutro",
                energia: 0,
                poder: 0,
                resistencia: 600,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Reciclagem Automática",
                        Tipo = "Passiva",
                        Descricao = "Sempre que for destruído, jogue um novo Protecto do baralho ou da pilha de sucata (se tiver).",
                        Ativar = (jogador, adversario) =>
                        {
                            // A habilidade é passiva, então não precisa de lógica de ativação.
                            // A lógica de substituição será implementada no sistema de destruição de cartas.
                        }
                    }
                }
            )
        };
    }

    // Lista de heróis pré-definidos
    public static List<Carta> CriarDeckHerois()
    {
        return new List<Carta>
        {
            new Carta(
                nome: "Mega Man",
                tipo: "Herói",
                elemento: "Neutro",
                energia: 2,
                poder: 2000,
                resistencia: 5000,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Adaptação de Combate",
                        Tipo = "Passiva",
                        Descricao = "Sempre que um herói adversário é destruído, pode copiar qualquer habilidade dele. Não copiar mais de uma habilidade.",
                        Ativar = (jogador, adversario) =>
                        {
                            if (adversario.HeroisDestruídos > jogador.HeroisDestruídos) // Verifica se o adversário perdeu um herói
                            {
                                var ultimoHeroiDestruido = adversario.Sucata.LastOrDefault(c => c.Tipo == "Herói");
                                if (ultimoHeroiDestruido != null && ultimoHeroiDestruido.Habilidades != null)
                                {
                                    // Exibe as habilidades disponíveis para copiar
                                    Console.WriteLine($"Escolha uma habilidade do {ultimoHeroiDestruido.Nome} para copiar:");
                                    for (int i = 0; i < ultimoHeroiDestruido.Habilidades.Count; i++)
                                    {
                                        Console.WriteLine($"{i + 1}. {ultimoHeroiDestruido.Habilidades[i].Nome}");
                                    }

                                    // Solicita a escolha do jogador
                                    int escolha;
                                    bool escolhaValida = int.TryParse(Console.ReadLine(), out escolha);
                                    if (escolhaValida && escolha >= 1 && escolha <= ultimoHeroiDestruido.Habilidades.Count)
                                    {
                                        var habilidadeParaCopiar = ultimoHeroiDestruido.Habilidades[escolha - 1];

                                        // Verifica se a habilidade já foi copiada
                                        if (!jogador.HeroiAtivo.Habilidades.Any(h => h.Nome == habilidadeParaCopiar.Nome))
                                        {
                                            jogador.HeroiAtivo.Habilidades.Add(habilidadeParaCopiar);
                                            Console.WriteLine($"{jogador.HeroiAtivo.Nome} copiou a habilidade '{habilidadeParaCopiar.Nome}' do {ultimoHeroiDestruido.Nome}!");
                                        }
                                        else
                                        {
                                            Console.WriteLine($"{jogador.HeroiAtivo.Nome} já possui a habilidade '{habilidadeParaCopiar.Nome}'.");
                                        }
                                    }
                                    else
                                    {
                                        Console.WriteLine("Escolha inválida. Nenhuma habilidade foi copiada.");
                                    }
                                }
                            }
                        }
                    }
                }
            ),
            new Carta(
                nome: "Proto Man",
                tipo: "Herói",
                elemento: "Neutro",
                energia: 3,
                poder: 4000,
                resistencia: 2000,
                habilidades: new List<Habilidade>
                {
                    new Habilidade
                    {
                        Nome = "Escudo de Proteção",
                        Tipo = "Passiva",
                        Descricao = "Enquanto estiver na área de suporte, Proto Man pode defender o herói ativo, tomando o dano por ele.",
                        Ativar = (jogador, adversario) =>
                        {
                            if (jogador.HeroiSuporte?.Nome == "Proto Man" && jogador.HeroiAtivo != null && adversario.HeroiAtivo != null)
                            {
                                Console.WriteLine("Proto Man defendeu o herói ativo!");
                                jogador.HeroiSuporte.ReceberDano(adversario.HeroiAtivo.Poder);
                                adversario.HeroiAtivo.Poder = 0; // Zera o dano do ataque
                            }
                        }
                    }
                }
            ),
            new Carta(
                nome: "Roll",
                tipo: "Herói",
                elemento: "Neutro",
                energia: 1,
                poder: 1500,
                resistencia: 2000,
                habilidades: null
            ),
            new Carta(
                nome: "Bass",
                tipo: "Herói",
                elemento: "Neutro",
                energia: 3,
                poder: 3500,
                resistencia: 4000,
                habilidades: null
            ),
            new Carta(
                nome: "Zero",
                tipo: "Herói",
                elemento: "Neutro",
                energia: 3,
                poder: 4000,
                resistencia: 3500,
                habilidades: null
            )
        };
    }
}

public class Carta
{
    public string Nome { get; set; }
    public string Tipo { get; set; }
    public string Elemento { get; set; }
    public int Energia { get; set; }
    public int Poder { get; set; }
    public int Resistencia { get; set; }
    public List<Habilidade> Habilidades { get; set; }

    public Carta(string nome, string tipo, string elemento, int energia, int poder, int resistencia, List<Habilidade> habilidades)
    {
        Nome = nome;
        Tipo = tipo;
        Elemento = elemento;
        Energia = energia;
        Poder = poder;
        Resistencia = resistencia;
        Habilidades = habilidades ?? new List<Habilidade>();
    }

    public void ReceberDano(int dano)
    {
        Resistencia -= dano;
        if (Resistencia < 0)
        {
            Resistencia = 0;
        }
    }
}

public class Habilidade
{
    public string Nome { get; set; }
    public string Tipo { get; set; }
    public string Descricao { get; set; }
    public Action<Jogador, Jogador> Ativar { get; set; }
}
